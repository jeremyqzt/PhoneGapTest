<!DOCTYPE html>
<!--
    Copyright (c) 2012-2016 Adobe Systems Incorporated. All rights reserved.

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
     KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
-->
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />

    <!-- This is a wide open CSP declaration. To lock this down for production, see below. -->
<!--     <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *" />
 -->    <!-- Good default declaration:
    * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
    * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
    * Disables use of eval() and inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
        * Enable inline JS: add 'unsafe-inline' to default-src
        * Enable eval(): add 'unsafe-eval' to default-src
    * Create your own at http://cspisawesome.com
    -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: 'unsafe-inline' https://ssl.gstatic.com; style-src 'self' 'unsafe-inline'; media-src *" /> -->
	<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">

    <link rel="stylesheet" href="css/circle.css">
    <link rel="stylesheet" type="text/css" href="css/index.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.9.0/math.min.js"></script>
    <script src="https://cdn.rawgit.com/kimmobrunfeldt/progressbar.js/0.5.6/dist/progressbar.js"></script>

    <script src="https://cdn.firebase.com/js/client/2.4.2/firebase.js"></script>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
	<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
	<script src="http://code.highcharts.com/highcharts.js"></script>
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<script src="https://code.highcharts.com/highcharts-more.js"></script>
	<script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script src="http://code.highcharts.com/modules/exporting.js"></script>

    <title>Hello World</title>
</head>

<body>
	<div data-role="tabs" id="tabs">
	<div data-role="navbar">
	<ul>
	<li><a href="#one" data-ajax="false">Summary</a></li>
	<li><a href="#two" data-ajax="false">Health</a></li>
	<li><a href="#three" data-ajax="false">Vehicle</a></li>
	</ul>
	</div>


	  <div id="one" class="ui-body-d ui-content">

		<div id = "wrapper">
		<div id= "indicate">	
		</div>

		<div id= "infoH2">
			<h2 id = "lower">Everything: Good!</h2>
			<h6 id = "warn">Everything is Okay!</h6>
		</div>
		</div>
		<br>
		<hr>

		<br>
		<h2>Alertness</h2> 
		<br>
	    <div class="w3-progress-container">
	    <div id = "alert" class="w3-progressbar w3-green" style="width:80%"><h5>Alertness</h5></div>
	  	</div>
	  	<p> Blink measures your alertness through a camera module, the display is a percentage of times in which you were alert, the higher this number, the better your alertness.</p>
		<br>

		<h2>Health</h2> 

	  <div class="w3-progress-container">
	    <div id = "health" class="w3-progressbar w3-lime" style="width:91%"><h5>Health</h5></div>
	  </div>
    	<p> Blink measures your health through several different sensors: your heart rate, the ambient temperature, the luminosity of the current conditions and factors in a comphensive history of your driving. This
    	number represents the percentage of measurements that are with you acceptable ranges. The higher this number, the better your detected health.
    	</p>
    	<br>
		<h2>Vehicle</h2> 

	  <div class="w3-progress-container">
	    <div id = "veh" class="w3-progressbar w3-blue" style="width:75%"><h5>Operation</h5></div>
	  </div>
    	<p> Blink measures your driving with inputs from your car as well as your driving history, if you stray too often from regular limits, this value will decrease. Should you get into a accident, Blink will be there to log your data.
    	</p>
	</div>




	  <div id="two">

		<div id = "wrapper">
		<div id= "iconH">
			<i id = "heart" class="material-icons heart2" style="font-size:60px;color:#f44336;">favorite</i>
		</div>
		<div id= "infoH">
			<h1>Heart Rate</h1>
			<h6 id = "Heart">Acquiring Data from the Sensor</h6>
		</div>
		</div>
		<br>

		<div id="container" style="width: 100%; height: 200px; margin: 0 auto"></div>


		<hr>
		<br>
		<div id = "wrapper">
		<div id= "iconH">
			<i id = "bright" class="material-icons" style="font-size:60px;color:#F57F17;">brightness_high</i>
		</div>
		<div id= "infoH">
			<h1>Brightness</h1>
 			<h6 id = "light"></h6>

		</div>
		</div>
		<hr>
		<br>
		<div id = "wrapper">
		<div id= "iconH">
			<i id = "temp" class="material-icons" style="font-size:60px;color:#0277BD;">priority_high</i>
		</div>
		<div id= "infoH">
			<h1>Temperature</h1>
 			<h6 id = "Temperature">37</h6>
		</div>
		</div>


	  </div>

		<div id = "three" class = "ui-body-d ui-content">



			<div id = "Bigwrapper">

	       		<div id="speed_div"></div>
				<div id= "info3">
					<h1>Speed</h1>
					<h6 id = "speed">60 KMPH</h6>
				</div>
			</div>

			<hr>


			<div id = "Bigwrapper">

	       		<div id="acc_div"></div>
				<div id= "info3">
					<h1>Acceleration</h1>
					<h6 id = "acc">60 KMPH</h6>
				</div>
			</div>


       		<hr>
			<h2>Vehicle Status</h2>

       		<div id = "brakeDiv">
			<i id = "brake" class="material-icons heart2" style="font-size:60px;color:#689F38;">directions_car</i>
			<br>
			<p id="brakeD">Braking</p>
			</div>

			<div id = "climateDiv">
			<i id = "climate" class="material-icons heart2" style="font-size:60px;color:#F57F17;">format_align_left</i>
			<br>
			<p id="climateD">Climate On</p>
			</div>


			<div id = "roadDiv">
			<i id = "road" class="material-icons heart2" style="font-size:60px;color:#827717;">map</i>
			<br>
			<p id = "roadD">Highway</p>
			</div>

			<div id = "wiperDiv">
			<i id = "wiper" class="material-icons heart2" style="font-size:60px;color:#4FC3F7;">grain</i>
			<br>
			<p id="wiperD">Weather</p>
			</div>



		</div>
	</div>
	<div id="snackbar">Significant G-Force Detected, a Log has Been Created...</div>

    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>

    <script type="text/javascript">
    	var heartHost = document.getElementById("Heart");
    	var lightHost = document.getElementById("light");
    	var temperatureHost = document.getElementById("Temperature");
    	var speedHost = document.getElementById("speed");
    	var warnHost = document.getElementById("warn");
    	var heartavg = 0;
    	var stdev = 10;
    	var alertHost = document.getElementById("alert");
    	var healthHost = document.getElementById("health");
    	var vehHost = document.getElementById("veh");
    	var status = document.getElementById("lower");
    	var ind = document.getElementById("indicate");
		var carSpeed = 0;

    	function moveProgress(x, host){
    		//console.log(parseInt(host.style.width));
    		var now = parseInt(host.style.width);
    		if (now > x){ //subtracting from current
    			move(host, now, x, -1);
    			
    		}else{	//adding to current
    			move(host, now, x, 1);

    		}
    	}

    	function move(host, current, desired, inc){
    		  var width = current;
    		  var direction = inc;

			  var id = setInterval(frame, 7);
			  function frame() {
			  	if (width == desired){
			  	  	clearInterval(id)
			  	}else{
			      width += inc; 
			      host.style.width = width + '%'; 
			    }
    		  }
    	}

        app.initialize();
		function toast() {
		    var x = document.getElementById("snackbar")
		    x.className = "show";
		    setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
		}
		var flag = 0;
        var heartrate = 63;
        var light = 0;
        var prox = 0;
        var myFirebaseRef = new Firebase("https://androidwearheartrate.firebaseio.com/");
    	var acc_array = 0;
    	var speedcount = 0;
    	var acccount = 0;
    	var vectoracc = [0,0,0];
    	var gyro = [0,0,0];
    	var heart_array = [60];
    	var wiper = 0;
		var myVar = setInterval(period, 1000);
		var sleep = "true";
		var watchLight = 0;
		var good = false;
		var watchGyro = [0,0,0];
		var currentdate = new Date(); 
		var datetime = ""+currentdate.getDate() + "/"
                + (currentdate.getMonth()+1)  + "/" 
                + currentdate.getFullYear() + " @ "  
                + currentdate.getHours() + ":"  
                + currentdate.getMinutes() + ":" 
                + currentdate.getSeconds();

		function fireput(){
			myFirebaseRef.push({
			  time: datetime,
			  speed: carSpeed,
			  heartrate: heartrate,
			  acceleration: vectoracc,
			  light: light,
			  proximity: prox,
			  sleeping: sleep,
			  gyroscope: gyro,
			  braking: braking,
			  heartRateAvg: heartavg,
			  heartRatestd: stdev,
			  watchGyro: watchGyro
			});
		}
		var five = 0;
		var length = 0;
		var age = 22;
		var gender = "Undefined";
		var care = "None";
		var mono = false;
		var monodec = false;
		var status = 1; // 0 Alert, 1 top, 2 bottom, 3 else
		var multiplier = 1;
		var genderdev = 0;

		function period() {
			//Gravity Vectoring
			if (gender = "Female"){
				genderdev = 10;
			}

			five +=1;
			if (five == 5){ //Check the Vector //per 5 seconds vectoring
				five =0;
				if ((watchGyro[2] > 0) & (watchGyro[2] < 8)){ //10 and 2 position
					status = 0;
				}else if (watchGyro[2] >= 8){
					status = 1; //top leaning
				}else if (watchGyro[2] < 0 ){
					status = 2;
				}else{
					status = 3;
				}

			}

			//Turning Radius


			//Too Much Acceleration
			if (acc_array > 15){
				speedcount+=1;
			}else{
				speedcount = 0;
			}

			if ((speedcount > 3) & (status !=0)){ //Remove Alert if driver is alert
				lower.innerHTML = "Speed";
				warnHost.innerHTML = "Blink has detected " + Math.round( 10*(acc_array/10))/10 + " Gs of acceleration for " +speedcount + " seconds now, consider slowing down!";
				ind.style.backgroundColor = "#F9A825";
				good = false;
			}

			var rotation = Math.sqrt(gyro[0]*gyro[0]+gyro[1]*gyro[1]+gyro[2]*gyro[2]);
			//Abnormal Rotation
			if (rotation > 0.40){
				if (rotation > 0.50){
					lower.innerHTML = "Rotation";
					warnHost.innerHTML = "Significant Rotation Detected: " + rotation;
					ind.style.backgroundColor = "#c62828";
					good = false;
				}
			  	$("#indicate").pulse({times: 1, duration: 300});	
				if (wiper ==1){ //rotation and weather
					lower.innerHTML = "Rotation";
					warnHost.innerHTML = "High Rotation Vector: " + rotation;
					ind.style.backgroundColor = "#c62828";
			  		$("#indicate").pulse({times: 1, duration: 300});
			  		good = false;
			  	}
			} 

			//Non Linear Acceleration
			if ((vectoracc[0] > 3) & (vectoracc[2] > 15)){
				acccount +=1;
			}else{
				acccount =0;
			}

			if(acccount > 3){ //prolonged non linear, Roundabouts
				warnHost.innerHTML = "Movement is Constantly Non Linear!";
				if (vectoracc[2] > 22){//Extreme and non linear
					lower.innerHTML = "Extreme Acceleration";
					warnHost.innerHTML = "Blink has detected extreme and non linear acceleration, consider slowing down";
					ind.style.backgroundColor = "#c62828";
			  		$("#indicate").pulse({times: 1, duration: 300});	
			  		good = false;
			  	}
				if (wiper == 1){
					lower.innerHTML = "Weather";
					warnHost.innerHTML = "You are driving too fast for these conditions";
					ind.style.backgroundColor = "#c62828";
			  		$("#indicate").pulse({times: 1, duration: 300});
			  		good = false;	
			  	}
			}

			//Temp Extrmemes
			if ((temp - 4) > 35){
				lower.innerHTML = "Temperature: High";
				warnHost.innerHTML = "Consider turning on the cool air," + (temp-4)+ " Celsius is too warm for operation";
				ind.style.backgroundColor = "#F9A825";	
				good = false;				
			} 

			if ((temp) < 15){
				lower.innerHTML = "Temperature: Low";
				warnHost.innerHTML = "Consider turning on the cool air," + temp+ " Celsius is too cold for operation";
				ind.style.backgroundColor = "#F9A825";		
				good = false;
			} 

			//Heart Rate Deviation, standard without warning
			heartavg = math.mean(heart_array);

			stdev = math.std(heart_array); //Prevention of early wanrings

			if (stdev < 10){
				stdev = 10;
			}
			stdev *= multiplier;

			// console.log("hr"+heartrate);
			// console.log("avg"+heartavg);
			// console.log("stdev"+stdev);
			//Trend Checking
			length = heart_array.length;
			var loop;
			loop = length - 1;
			if (length > 7){
				if((heart_array[loop] > heart_array[loop -1 ]) & (heart_array[loop-1] > heart_array[loop -2 ]) & (heart_array[loop-2] > heart_array[loop -3 ]) & (heart_array[loop-3] > heart_array[loop -4 ]) &(heart_array[loop-4] > heart_array[loop -5 ])){
					mono = true; // monotonically increasing
				}else{
					mono = false
				}


				if((heart_array[loop] < heart_array[loop -1 ]) & (heart_array[loop-1] < heart_array[loop -2 ]) & (heart_array[loop-2] < heart_array[loop -3 ]) & (heart_array[loop-3] < heart_array[loop -4 ]) &(heart_array[loop-4] < heart_array[loop -5 ])){
					monodec = true; // monotonically increasing
				}else{
					monodec = false
				}
			}


			//Monotonaticity of Input, Easy to see something wrong, ignores status


			//Fluctuation Accounting, trending high, accounts status


			//Fluctuation Accounting, trending low, accounts status
			if ((heartrate < (180 + genderdev)) & (heartrate > (40+genderdev))){ //Sanitization of inputs
				if (heartrate > heartavg){
					if ((heartrate - heartavg) > 1.5*stdev){
							lower.innerHTML = "High Heartrate";
							var hdev = (heartrate - heartavg)/stdev;
							hdev = Math.round( hdev* 10) / 10;
							warnHost.innerHTML = "Blink has detected abnormal heart rate readings, over " +hdev+" past your normal range, considering pulling over";
							ind.style.backgroundColor = "#c62828";
			  				$("#indicate").pulse({times: 1, duration: 300});	
			  				good = false;

			  			if (vectoracc[2] > 22 ){
							lower.innerHTML = "Acceleration & Stress";
							warnHost.innerHTML = "Blink has detected eratic driving behavior, consider slowing down or taking a break";
							ind.style.backgroundColor = "#c62828";
							good = false;
			  				$("#indicate").pulse({times: 1, duration: 300});	
			  			}
						if (mono){ //Abnormal Rotation and Heart Rate
							lower.innerHTML = "Heart Rate";
							warnHost.innerHTML = "Blink has detected abnormal heart rate readings, over " +hdev+" past your normal range, considering pulling over";
							ind.style.backgroundColor = "#c62828";
			  				$("#indicate").pulse({times: 1, duration: 300});
			  				good = false;
			  			}
						if(acccount > 3){ //non linear acc and heart rate
							lower.innerHTML = "Acceleration & Stress";
							warnHost.innerHTML = "Blink has detected eratic driving behavior, consider slowing down or taking a break";
							ind.style.backgroundColor = "#c62828";
			  				$("#indicate").pulse({times: 1, duration: 300});			
			  				good = false;			
			  			}
					}
				}else{
					if ((heartavg - heartrate) > 1.5*stdev){
						if (vectoracc[2] > 22 ){
							lower.innerHTML = "Fainting";
							warnHost.innerHTML = "Blink has detected abnormal heart rate readings, over " +hdev+" past your normal range, considering pulling over";
							ind.style.backgroundColor = "#c62828";
			  				$("#indicate").pulse({times: 1, duration: 300});
			  				good = false;
						}						}
						if (rotation > 0.45){ //Abnormal Rotation and Heart Rate
							lower.innerHTML = "Heart Rate";
							warnHost.innerHTML = "Blink has detected abnormal heart rate readings, over " +hdev+" past your normal range, considering pulling over";
							ind.style.backgroundColor = "#c62828";
			  				$("#indicate").pulse({times: 1, duration: 300});
			  				good = false;
			  			}
			  			if (monodec){ //Abnormal Rotation and Heart Rate
							lower.innerHTML = "Rotation";
							warnHost.innerHTML = "Decreasing heartrate, please pull over and call for help!";
							ind.style.backgroundColor = "#c62828";
			  				$("#indicate").pulse({times: 1, duration: 300});
			  				good = false;
			  			}
						if(acccount > 3){ //non linear acc and heart rate
							lower.innerHTML = "Acceleration & Stress";
							warnHost.innerHTML = "Blink has detected eratic driving behavior, consider slowing down";
							ind.style.backgroundColor = "#c62828";
			  				$("#indicate").pulse({times: 1, duration: 300});
			  				good = false;
	  					}

				}
			}

			//Abnormal Light
			if (((light < 50)&(watchLight < 50)) || ((status != 0) & (sleep == "false"))){ //Driving Override
				lower.innerHTML = "Brightness: Low";
				var avg_bright = (light+watchLight)/2
				warnHost.innerHTML = "Blink has detected low brightness, with only " +avg_bright +" lux, its easy to fall asleep";
				ind.style.backgroundColor = "#F9A825";		
				good = false;				
			}

			if (light > 4000){ //UNlikely to occur
				lower.innerHTML = "Brightness: Extreme";
				var avg_bright = (light+watchLight)/2

				warnHost.innerHTML = "Blink has detected extreme brightness, with only " +avg_bright +" lux, its will be hard to see";
				ind.style.backgroundColor = "#F9A825";	
				good = false;		
			}

			//proximity
			if ((prox < 3) & (carSpeed > 10) & (status != 0)){
				lower.innerHTML = "Operation";
				warnHost.innerHTML = "Please do not operating while driving";
				ind.style.backgroundColor = "#F9A825";
				good = false;

			}

			//Extreme Acc and Abnormal Rotation, sensitive version
			if (rotation > 0.5){
				if (speedcount > 3){
					lower.innerHTML = "Rotation & Speed";
					warnHost.innerHTML = "Blink has detected that the vehicle is rotating due to Acceleration, consider slowing down and reducing your turn readius";
					ind.style.backgroundColor = "#c62828";
	  				$("#indicate").pulse({times: 1, duration: 300});
	  				good = false;

				}
			} 

			if (sleep == "false"){
				lower.innerHTML = "Driver Drowsy";
				warnHost.innerHTML = "Blink has detected that the driver is drowsy, we recommend taking a break and getting a coffee";
				ind.style.backgroundColor = "#c62828";
  				$("#indicate").pulse({times: 1, duration: 300});	
  				good = false;
			}else{
				        		alert +=1;
			}
        	
        	totalalert +=1;
        	moveProgress(parseInt(100*alert/totalalert), alertHost);


			if (good == true){
				lower.innerHTML = "Systems Nominal";
				warnHost.innerHTML = "Keep up the good driving";
				ind.style.backgroundColor = "#2E7D32";

			}
			good = true;
			console.log(Math.sqrt(watchGyro[0]*watchGyro[0] + watchGyro[1]*watchGyro[1] + watchGyro[2]*watchGyro[2]));

			if ( ((Math.sqrt(watchGyro[0]*watchGyro[0] + watchGyro[1]*watchGyro[1] + watchGyro[2]*watchGyro[2])) > 25)){
				var currentdate = new Date(); 
				var datetime = "" + currentdate.getDate() + "/"
                + (currentdate.getMonth()+1)  + "/" 
                + currentdate.getFullYear() + " @ "  
                + currentdate.getHours() + ":"  
                + currentdate.getMinutes() + ":" 
                + currentdate.getSeconds();
				fireput();
				toast();
			}
			var random = Math.round(Math.random()-0.01);
			var random2 = Math.round(Math.random()*10);
			if (random2 == 1){
				random2 = 2;
			}else if (random2 ==2){
				random2 = 3;
			}else{
				random2 = 0;
			}

			if (flag == 0){
				if (random == 0){
					heartrate += random2;
				}else{
					heartrate -= random2;
				}

				heartHost.innerHTML = "Your Heart Rate: " + heartrate + " BPM"; 
        		 
	        	heart_array.push(heartrate);
			}

		}
		var accbar = 0;
		var accbar_total = 0;
		var per = 0;
        myFirebaseRef.child("Vehicle/Acceleration").on("value", function(snapshot) {
        	acc_array = snapshot.val();
        	accbar_total +=1;
        	if (acc_array < 15){
        		accbar +=1;
        	}
        	per = parseInt(100*accbar/accbar_total);
        	moveProgress(per, vehHost);
		});

		myFirebaseRef.child("InformationSet/watchLight").on("value", function(snapshot) {
        	watchLight = snapshot.val();
        	console.log(watchLight);
		});

		myFirebaseRef.child("InformationSet/watchGyro").on("value", function(snapshot) {
        	watchGyro = snapshot.val();
        	
		});



    	var alert = 0;
    	var totalalert = 0;
        myFirebaseRef.child("openCV/sleeping").on("value", function(snapshot) {
        	sleep = snapshot.val();


		});


        myFirebaseRef.child("Vehicle/Wiper").on("value", function(snapshot) {
        	wiper = snapshot.val();
		});

        myFirebaseRef.child("InformationSet/gyro").on("value", function(snapshot) {
        	gyro = snapshot.val();
		});

        myFirebaseRef.child("InformationSet/acc").on("value", function(snapshot) {
        	vectoracc = snapshot.val();
		});
		var okay = 0;
		var totalokay = 0;

        myFirebaseRef.child("InformationSet/heartProxLight").on("value", function(snapshot) {
        	temp = parseInt(snapshot.val()[3]);
        	prox = parseInt(snapshot.val()[1]);
        	light = snapshot.val()[2];
        	lightHost.innerHTML = "Preceived Brightness: " + light + " Lux";
        	temperatureHost.innerHTML = "Ambient Temperature: " + temp + " C"

        	if (parseInt(snapshot.val()[0]) > 0){
	        	heartrate = parseInt(snapshot.val()[0]);
  				heartHost.innerHTML = "Your Heart Rate: " + heartrate + " BPM"; 
	        	heart_array.push(heartrate);
	        	flag = 1;

  			}else{
  				flag = 0;
  			}

  			if (heartrate > 120){
  				$("#heart").pulse({times: 1, duration: 300});
  				okay +=1;
  			}
  			totalokay +=1;
        	moveProgress(parseInt(100*(totalokay-okay)/totalokay), healthHost);


  			if (light > 500){
  				$('#bright').pulse({times: 1, duration: 300});
  			}

  
  			if (temp > 40 || temp <10){
  				$("#temp").pulse({times: 1, duration: 300});
  			}
		});

		$.fn.pulse = function(options) {

		    var options = $.extend({
		        times: 3,
		        duration: 1000
		    }, options);

		    var period = function(callback) {
		        $(this).animate({opacity: 0}, options.duration, function() {
		            $(this).animate({opacity: 1}, options.duration, callback);
		        });
		    };
		    return this.each(function() {
		        var i = +options.times, self = this,
		        repeat = function() { --i && period.call(self, repeat) };
		        period.call(this, repeat);
		    });
		};


		var cw = $('#MydivHR').width();
		$('#MydivHR').css({'height':cw+'px'});
		$('#MydivHR').css({'border-radius':cw+'px'});

		$('#MydivProx').css({'height':cw+'px'});
		$('#MydivProx').css({'border-radius':cw+'px'});

		$('#MydivLight').css({'height':cw+'px'});
		$('#MydivLight').css({'border-radius':cw+'px'});

		$(function () {
		    $(document).ready(function() {
		        Highcharts.setOptions({
		            global: {
		                useUTC: false
		            }
		        });
		    
		        var chart;
		        $('#container').highcharts({
		            chart: {
		                type: 'line',
		                backgroundColor: '#FFFFFF',
		                animation: Highcharts.svg, 
		                marginRight: 10,
		                events: {
		                    load: function() {
		    	                var series = this.series[0];
		                        setInterval(function() {
		                            var x = (new Date()).getTime(), 
		                                y = heartrate;
		                            series.addPoint([x, y], true, true);
		                        }, 1500);
		                    }
		                }
		            },
		            title: {
		                text: ''
		            },
		            xAxis: {
		                type: 'datetime',
		                tickPixelInterval: 150
		            },
		            yAxis: {
		                title: {
		                    text: 'BMP'
		                },
		                plotLines: [{
		                    value: 0,
		                    width: 1,
		                    color: '#808080'
		                }]
		            },
		            tooltip: {
		                formatter: function() {
		                        return '<b>'+ this.series.name +'</b><br/>'+
		                        Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) +'<br/>'+
		                        Highcharts.numberFormat(this.y, 2);
		                }
		            },
		            legend: {
		                enabled: false
		            },
		            exporting: {
		                enabled: false
		            },
		            series: [{
		                name: 'Heart Rate',
		                data: (function() {
		                    var data = [],time = (new Date()).getTime(),i;
		                    for (i = -19; i <= 0; i++) {
		                        data.push({x: time + i * 1000,heartrate});
		                    }
		                    return data;
		                })()
		            }]
		        });
		    });
		    
		});
		var carAcc;

        myFirebaseRef.child("Vehicle/Speed").on("value", function(snapshot) {
        	speedHost.innerHTML = "Speed: " + snapshot.val() +"KM/Hour";
        	carSpeed = snapshot.val();
		});

		myFirebaseRef.child("Vehicle/Acceleration").on("value", function(snapshot) {
        	document.getElementById("acc").innerHTML = "Acceleration: " + snapshot.val() +"KM<sup>2</sup>/Hour";
        	carAcc = snapshot.val();
		});

		myFirebaseRef.child("Person/Age").on("value", function(snapshot) {
        	age = snapshot.val();
        	if (age > 80){
        		age = 80;
        	}
			multiplier =0.8+(0.2*((80-age)/58));

		});

		myFirebaseRef.child("Person/Gender").on("value", function(snapshot) {
        	gender = snapshot.val();
		});


		myFirebaseRef.child("Person/Care").on("value", function(snapshot) {
        	care = snapshot.val();
		});
		var braking = 0;
		myFirebaseRef.child("Vehicle/Braking").on("value", function(snapshot) {
        	if (snapshot.val() == 1){
        		document.getElementById("brakeD").innerHTML = "Braking";
				document.getElementById("brake").style.color = "#689F38"
        	} else{
        		document.getElementById("brakeD").innerHTML = "Accelerating";
				document.getElementById("brake").style.color = "#B0BEC5"
        	}
        	braking = snapshot.val();
		});

		myFirebaseRef.child("Vehicle/Roadtype").on("value", function(snapshot) {
        	if (snapshot.val() == 1){
        		document.getElementById("roadD").innerHTML = "Highway";
				document.getElementById("road").style.color = "#263238"
        	} else{
        		document.getElementById("roadD").innerHTML = "Local Roads";
				document.getElementById("road").style.color = "#9E9D24"
        	}
		});

		myFirebaseRef.child("Vehicle/Wiper").on("value", function(snapshot) {
        	if (snapshot.val() == 1){
        		document.getElementById("wiperD").innerHTML = "Weather Conditions";
				document.getElementById("wiper").style.color = "#4FC3F7"
        	} else{
        		document.getElementById("wiperD").innerHTML = "Clear";
				document.getElementById("wiper").style.color = "#424242"
        	}
		});

		myFirebaseRef.child("Vehicle/Climate").on("value", function(snapshot) {
        	if (snapshot.val() == 1){
        		document.getElementById("climateD").innerHTML = "Climate On";
				document.getElementById("climate").style.color = "#F57F17"
        	} else{
        		document.getElementById("climateD").innerHTML = "Climate Off";
				document.getElementById("climate").style.color = "#424242"
        	}
		});


      google.charts.load('current', {'packages':['gauge']});

      google.charts.setOnLoadCallback(drawChart);
      google.charts.setOnLoadCallback(drawChart2);

      function drawChart() {
        var data = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['Speed', 0],
        ]);
        var options = {
          max: 220, min: 0,
          width: 120, height: 120,
          redFrom: 200, redTo: 220,
          yellowFrom: 130, yellowTo: 200,
          minorTicks: 10
        };
        var chart = new google.visualization.Gauge(document.getElementById('speed_div'));
        chart.draw(data, options);
        setInterval(function() {
          data.setValue(0, 1, carSpeed);
          chart.draw(data, options);
        }, 500);
      }



     function drawChart2() {
        var data = google.visualization.arrayToDataTable([
          ['Label', 'Value'],
          ['Acceleration', 0],
        ]);
        var options = {
          max: 30, min: 0,
          width: 120, height: 120,
          redFrom: 25, redTo: 30,
          yellowFrom: 15, yellowTo: 25,
          minorTicks: 1
        };
        var chart = new google.visualization.Gauge(document.getElementById('acc_div'));
        chart.draw(data, options);
        setInterval(function() {
          data.setValue(0, 1, carAcc);
          chart.draw(data, options);
        }, 500);
      }


	
    </script>
</body>

</html>